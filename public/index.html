<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>InkWell</title>
  <link href="https://fonts.googleapis.com/css2?family=Alice&display=swap" rel="stylesheet" />
  <style>
    :root {
      --title-font: 'Helvetica Neue', sans-serif;
      --body-font: 'Alice', serif;
      --dark-title: #2A2A2A;
      --dark-text: #555555;
      --light-text: #999999;
    }

    .btn {
  margin-top: 0.5em;
  padding: 0.5em 1em;
  font-size: 0.95em;
  background-color: #FFA76D;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
.btn:hover {
  background-color: #e8965e;
}

    h1, h2, h3, h4, h5 {
      font-family: var(--title-font);
      color: var(--dark-title);
      font-weight: 600;
    }

    p, label, input, textarea, button {
      font-family: var(--body-font);
      color: var(--dark-text);
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --dark-title: #FFFFFF;
        --dark-text: #CCCCCC;
        --light-text: #999999;
      }

      h1, h2, h3, h4, h5 {
        color: var(--dark-title);
      }

      p, label, input, textarea, button {
        color: var(--dark-text);
      }

      /* Ensure journal entry preview text is visible when collapsed in dark mode */
      .entry-preview,
      .entry-preview * {
        color: #CCCCCC !important;
      }

      .coach-reply {
        background-color: #2a2a2a;
        border-left: 4px solid #FFA76D;
        color: #CCCCCC;
      }
    }

    body {
      margin: 0;
      font-family: var(--body-font);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2em;
    }
    /* Light mode styles */
    @media (prefers-color-scheme: light) {
      body {
        background-color: #EAF6FB;
        color: #2A6D6D;
      }
      main {
        background: white;
        color: inherit;
      }
      input,
      textarea {
        background-color: #fff;
        border: 1px solid #ccc;
      }
      button {
        background-color: #FFA76D;
        color: white;
      }
      button:hover {
        background-color: #e8965e;
      }
    }

    /* Dark mode styles */
    @media (prefers-color-scheme: dark) {
      body {
        background-color: #1E1E1E;
        color: #CCCCCC;
      }
      main {
        background: #2A2A2A;
        color: inherit;
      }
      input,
      textarea {
        background-color: #333;
        border: 1px solid #666;
      }
      button {
        background-color: #FFA76D;
        color: white;
      }
      button:hover {
        background-color: #e8965e;
      }
      /* Override calendar text color for dark mode for better visibility */
      #calendarTab th,
#calendarTab td,
#calendarTab p,
#calendarTab h2,
#calendarTab h3 {
  color: var(--dark-text);
}
      /* Fix dark mode text color for Favorite Prompts block */
      #favoritePromptsList,
      #favoritePromptsList p,
      details summary {
        color: var(--dark-text);
      }
      /* Footer copyright and links dark mode override */
      footer,
      footer p,
      footer a {
        color: #EAF6FB !important;
      }
    }
    header {
      text-align: center;
      margin-bottom: 2em;
    }
    h1 {
      color: #FFA76D;
      font-size: 2.5em;
    }
    main {
      background: white;
      padding: 2em;
      border-radius: 10px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      color: inherit;
    }
    textarea {
      width: 100%;
      height: 200px;
      padding: 1em;
      font-family: 'Alice', serif;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 5px;
      resize: vertical;
    }

    /* Flash confirmation animation for journal entry */
    .flash-confirmation {
      animation: flashHighlight 1s ease-in-out;
    }
    @keyframes flashHighlight {
      0% { background-color: #D4F5D0; }
      50% { background-color: #A1E3A1; }
      100% { background-color: transparent; }
    }

    .spinner {
  display: inline-block;
  width: 1em;
  height: 1em;
  border: 2px solid rgba(255, 167, 109, 0.3);
  border-top-color: #FFA76D;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-right: 0.5em;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
    /* Mobile Responsive Styles */
    @media (max-width: 600px) {
      body {
        padding: 1em;
      }

      main {
        padding: 1em;
        max-width: 100%;
        border-radius: 0;
        box-shadow: none;
      }

      textarea {
        height: 150px;
      }

      button {
        width: 100%;
        font-size: 0.95em;
        padding: 0.5em;
      }

      header img {
        max-width: 100%;
        height: auto;
      }

      input[type="text"],
      input[type="date"],
      input[type="file"],
      textarea {
        font-size: 1em;
      }
    }
    html {
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    /* === InkWell Visual Theme Components === */
    .card-block {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 1em;
      margin-bottom: 2em;
      background-color: #f9f9f9;
    }

    

    .card-block p {
  font-size: 1em;
  line-height: 1.6;
}
    .section-header {
      font-size: 1.2em;
      color: #2A6D6D;
      margin-top: 0;
      margin-bottom: 0.5em;
    }

    .subtext-muted {
      font-size: 0.85em;
      color: #CCCCCC;
      font-style: italic;
      margin-top: 0.25em;
    }

    .entry-preview {
  max-height: 4.5em;
  overflow: hidden;
  position: relative;
}
    .entry-preview::after {
  content: "...";
  position: absolute;
  bottom: 0;
  right: 0;
  background: linear-gradient(to right, transparent, white 50%);
}

    /* Coach reply styling for Past Entries */
    .coach-reply {
      background-color: #f0f8ff;
      border-left: 4px solid #2A6D6D;
      padding: 0.5em;
      margin-top: 0.5em;
      font-style: italic;
      white-space: pre-wrap;
    }
  </style>
  <script type="module">
    // Firebase App (the core Firebase SDK) is always required
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-storage.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js";
    import {
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword
    } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js";
    import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-functions.js";

    // Firebase configuration for InkWell Alpha
    const firebaseConfig = {
      apiKey: "AIzaSyDivYKnp_SinGjL7iVVwSyQH-RnFHMFDM0",
      authDomain: "inkwell-alpha.firebaseapp.com",
      projectId: "inkwell-alpha",
      storageBucket: "inkwell-alpha.firebasestorage.app",
      messagingSenderId: "849610731668",
      appId: "1:849610731668:web:f06d1a63f0db6391674481",
      measurementId: "G-KHHZRVB7EJ"
    };

    const app = initializeApp(firebaseConfig);

    const db = getFirestore(app);
    window.db = db;
    window.getDocs = getDocs;
window.collection = collection;
    const storage = getStorage(app);
    const auth = getAuth(app);
    window.auth = auth;
    window.currentUserId = null;
// Handle embedded agreement button logic
window.acceptEmbeddedAgreement = async function () {
  const embeddedCheckbox = document.getElementById("embeddedAgreementCheckbox");
  const acceptEmbeddedBtn = document.getElementById("acceptEmbeddedAgreementButton");

  if (!embeddedCheckbox.checked || !window.currentUserId) return;

  try {
    await setDoc(doc(db, "userStatus", window.currentUserId), {
      agreedToAlphaTerms: true
    }, { merge: true });

    document.getElementById("embeddedAgreementNotice").style.display = "none";
    document.getElementById("journalTab").style.display = "block";
    document.getElementById("tabButtons").style.display = "flex";
  } catch (err) {
    alert("Error saving agreement: " + err.message);
    console.error("Detailed agreement save error:", err);
  }
};


// Enable the Accept button only when checkbox is checked
document.addEventListener("DOMContentLoaded", () => {
  const embeddedCheckbox = document.getElementById("embeddedAgreementCheckbox");
  const acceptEmbeddedBtn = document.getElementById("acceptEmbeddedAgreementButton");

  embeddedCheckbox?.addEventListener("change", () => {
    acceptEmbeddedBtn.disabled = !embeddedCheckbox.checked;
  });
});

    // Ensure functions is initialized after app
    const functions = getFunctions(app, "us-central1");

    let currentUserId = null;

onAuthStateChanged(auth, async (user) => {


  if (!user) {
    const justLoggedOut = localStorage.getItem("userJustLoggedOut") === "true";
    if (justLoggedOut) {
      localStorage.removeItem("userJustLoggedOut");
      document.getElementById("goodbyeModal").style.display = "flex";
    } else {
      document.getElementById("loginModal").style.display = "flex";
    }
    document.querySelector("main").style.display = "none";
    return;
  }

  // Guard: Only allow valid, non-anonymous users to access UI
  if (!user || !user.uid || user.isAnonymous) {
    document.querySelector("main").style.display = "none";
    return;
  }

  // Signed in
  currentUserId = user.uid;
  window.currentUserId = user.uid;
  const userDocRef = doc(db, "users", user.uid);
  const userDoc = await getDoc(userDocRef);
  // Ensure a users/{uid} document always exists (even for anonymous users)
  if (!userDoc.exists()) {
    await setDoc(userDocRef, {
      email: user.email || "",
      createdAt: serverTimestamp()
    });
  }
  const statusDocRef = doc(db, "userStatus", user.uid);
  const statusDoc = await getDoc(statusDocRef);

  // Display name / avatar
  const statusDiv = document.getElementById("userStatus");
  const displayName = userDoc.exists() && userDoc.data().displayName;
  statusDiv.textContent = displayName
    ? `Journaling as: ${displayName}`
    : user.email
      ? `Journaling as: ${user.email}`
      : "Journaling anonymously";
  if (userDoc.exists() && userDoc.data().avatarUrl) {
    const avatarImg = document.createElement("img");
    avatarImg.src = userDoc.data().avatarUrl;
    avatarImg.alt = "User Avatar";
    avatarImg.style.width = "40px";
    avatarImg.style.height = "40px";
    avatarImg.style.borderRadius = "50%";
    avatarImg.style.marginLeft = "10px";
    statusDiv.appendChild(avatarImg);
  }

  const agreed = statusDoc.exists() && statusDoc.data().agreedToAlphaTerms;
  if (!agreed) {
    document.getElementById("embeddedAgreementNotice").style.display = "block";
    document.getElementById("journalTab").style.display = "none";
    document.getElementById("tabButtons").style.display = "none";
    return;
  }

  // All checks passed, show main app
  document.getElementById("loginModal").style.display = "none";
  
  document.getElementById("goodbyeModal").style.display = "none";
  document.querySelector("main").style.display = "block";
  showTab('journalTab');
  // loadPastEntries();  // Moved to showTab to defer loading until Past Entries tab is shown
  // loadJournalTimeline(); // Disabled: #journalTimeline no longer exists

  
  buildCalendar();
});

window.onload = function () {
    window.saveJournalEntry = async function () {
      const textarea = document.getElementById("journal");
      const text = textarea.value.trim();
      // --- Begin: Insert logic to optionally include Sophy's reflection ---
      const includeReflection = document.getElementById("autoInsertReflection")?.checked;
      const sophyText = document.getElementById("sophyInsight")?.textContent || "";
      const finalText = includeReflection ? text + "\n\n[Sophy's Reflection]\n" + sophyText : text;
      // --- End: Insert logic to optionally include Sophy's reflection ---
      if (!text) return alert("Please enter something before saving.");
      showSpinner("saveStatus", "Saving...");

      try {
        let attachmentUrl = null;
        const fileInput = document.getElementById("attachment");
        const file = fileInput.files[0];
        const maxFileSizeMB = 10;
if (file && file.size > maxFileSizeMB * 1024 * 1024) {
  alert(`File exceeds ${maxFileSizeMB}MB limit. Please upload a smaller file.`);
  return;
}

        const previewDiv = document.getElementById("attachmentPreview");
        previewDiv.innerHTML = ""; // Clear previous preview

        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const img = document.createElement("img");
            img.src = e.target.result;
            img.alt = file.name;
            img.style.maxWidth = "100px";
            img.style.marginRight = "10px";
            img.style.borderRadius = "5px";
            previewDiv.appendChild(img);
          };
          if (file.type.startsWith("image/")) {
            reader.readAsDataURL(file);
          } else {
            const span = document.createElement("span");
            span.textContent = file.name;
            span.style.display = "inline-block";
            span.style.padding = "0.5em";
            span.style.background = "#eee";
            span.style.borderRadius = "5px";
            previewDiv.appendChild(span);
          }
        }

        if (file) {
          const storageRef = ref(storage, `attachments/${Date.now()}_${file.name}`);
          const snapshot = await uploadBytes(storageRef, file);
          attachmentUrl = await getDownloadURL(snapshot.ref);
        }

        const tagsInput = document.getElementById("tags")?.value.trim?.() || "";
        const tags = tagsInput ? tagsInput.split(",").map(tag => tag.trim()) : [];

        const entryData = {
          text: finalText,
          attachmentUrl,
          createdAt: new Date(),
          userId: currentUserId,
          tags
        };

        const promptText = document.getElementById("generatedPrompt")?.textContent;
        if (promptText?.includes("Sophy suggests:")) {
          entryData.promptUsed = promptText.split(":").slice(1).join(":").trim();
        }

        if (document.getElementById("coachReviewCheckbox")?.checked) {
          entryData.coachReview = true;
        }
        // Add to Firestore and get the new doc ref
        const docRef = await addDoc(collection(db, "journalEntries"), entryData);
        console.log("üìò Created entry ID:", docRef.id);
   if (entryData.coachReview) {
    try {
      console.log("üì® Notifying coach with entryId:", docRef.id);
const response = await fetch("https://us-central1-inkwell-alpha.cloudfunctions.net/notifyCoachOfTaggedEntry", {
  method: "POST",
  headers: {
    "Content-Type": "application/json"
  },
  body: JSON.stringify({ entryId: docRef.id })
});

if (!response.ok) {
  throw new Error("Coach notification failed: " + (await response.text()));
}
console.log("üì¨ Coach notified successfully.");
    } catch (notifyErr) {
      console.error("‚ùå Failed to notify coach:", notifyErr);
    }
  }

        if (document.getElementById("postSaveActions")?.checked) {
          entryData.maybeReviewLater = true;
        }
        if (journalMode === "manifest") {
          tags.push("manifest");
          const manifestText = document.getElementById("manifestInput").value.trim();
          const today = new Date().toISOString().split("T")[0];
          tags.push(`manifestDate:${today}`);
          entryData.contextManifest = manifestText;
        }


        // Call embedding function via HTTPS endpoint with fetch
        try {
          const token = await auth.currentUser.getIdToken(true);
          await fetch("https://us-central1-inkwell-alpha.cloudfunctions.net/embedAndStoreEntry", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${token}`
            },
            body: JSON.stringify({ text, entryId: docRef.id })
          });
        } catch (embedErr) {
          console.warn("Embedding error (non-blocking):", embedErr);
        }

        // Show saved confirmation
        saveStatus.innerHTML = "‚úÖ Saved!";
        setTimeout(() => saveStatus.innerHTML = "", 3000);
        document.getElementById("entryStatus").textContent = "Great work! You‚Äôve added another reflection to your journey.";
        // Flash confirmation animation on textarea
        textarea.classList.add("flash-confirmation");
        setTimeout(() => textarea.classList.remove("flash-confirmation"), 1000);

        textarea.value = "";
        fileInput.value = "";
        previewDiv.innerHTML = "";
        if (document.getElementById("tags")) document.getElementById("tags").value = "";
      } catch (e) {
        console.error("Error saving entry: ", e);
        const saveStatus = document.getElementById("saveStatus");
        saveStatus.innerHTML = "‚ùå Save failed.";
        setTimeout(() => saveStatus.innerHTML = "", 4000);
      }
    };
};

    async function generatePrompt() {
      const topicInput = document.getElementById("promptTopic").value.trim();
      const manifestText = document.getElementById("manifestInput").value.trim();
      let topic = topicInput;

      if (journalMode === "manifest") {
        if (topicInput && manifestText) {
          topic = `My manifest is: "${manifestText}". Please base the prompt on this and also consider: "${topicInput}".`;
        } else if (manifestText) {
          topic = `Please generate a prompt based on my Manifest Statement: "${manifestText}"`;
        } else {
          topic = topicInput || "manifesting";
        }
      }

      const promptElement = document.getElementById("generatedPrompt");
      // Set "Sophy is thinking..." in green italic before fetching
      promptElement.textContent = "Sophy is thinking...";
      promptElement.style.color = "#2A6D6D";
      promptElement.style.fontStyle = "italic";
      try {
        const response = await fetch("https://us-central1-inkwell-alpha.cloudfunctions.net/generatePrompt", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ topic })
        });
        if (response.ok) {
          const data = await response.json();
          const prompt = data.prompt.trim();
          promptElement.textContent = `Sophy suggests: "${prompt}"`;
          if (document.getElementById("autoInsertPrompt")?.checked) {
            const textarea = document.getElementById("journal");
            textarea.value = `"${prompt}"\n\n` + textarea.value;
          }
        } else {
          promptElement.textContent = "Sorry, something went wrong fetching the prompt.";
        }
      } catch (e) {
        promptElement.textContent = "Sorry, something went wrong fetching the prompt.";
      }
    }
    import { query, where, orderBy, getDocs, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js";

    async function loadPastEntries() {
      const pastEntriesContainer = document.getElementById("pastEntries");
      pastEntriesContainer.innerHTML = "<p>Loading entries...</p>";
      const entriesRef = collection(db, "journalEntries");
      const q = query(entriesRef, where("userId", "==", currentUserId), orderBy("createdAt", "desc"));
      let snapshot;
      try {
        snapshot = await getDocs(q);
      } catch (e) {
        pastEntriesContainer.innerHTML = "<p>We‚Äôre setting things up behind the scenes. This feature will be available shortly ‚Äî please check back soon.</p>";
        return;
      }
      if (snapshot.empty) {
        pastEntriesContainer.innerHTML = "<p>No journal entries yet. Try your first reflection ‚Äî it doesn‚Äôt have to be perfect.</p>";
        return;
      }

      const entriesHtml = [];
      for (const doc of snapshot.docs) {
        const entry = doc.data();
        // Skip entries with missing or invalid createdAt
        if (!entry.createdAt?.toDate) {
          console.warn("Skipping entry with missing or invalid createdAt:", entry);
          continue;
        }
        const repliesSnapshot = await getDocs(collection(doc.ref, "coachReplies"));
        let coachRepliesHtml = "";

        repliesSnapshot.forEach(replyDoc => {
          const replyData = replyDoc.data();
          coachRepliesHtml += `
            <div class="coach-reply">
              üë§ <strong>Coach reply:</strong><br/>
              ${replyData.replyText}
            </div>
          `;
        });

        // Only entries with valid createdAt reach here
        const date = entry.createdAt.toDate().toLocaleString();
        const tags = entry.tags ? `<p style="font-size: 0.85em; color: #666;">Tags: ${entry.tags.join(", ")}</p>` : "";
        // Highlight Manifest-tagged entries
        const isManifest = entry.tags?.includes("manifest");
        const manifestBadge = isManifest
          ? `<p style="font-size: 0.85em; color: #2A6D6D; font-style: italic;">‚ú® Reflecting on Manifest: "${entry.contextManifest || ''}"</p>`
          : "";
        const coachTag = entry.coachReview
          ? `<p style="font-size: 0.85em; color: #2A6D6D;">üîì Shared with coach</p>`
          : "";

        const futureFlag = entry.maybeReviewLater
          ? `<p style="font-size: 0.85em; color: #999;">üïäÔ∏è Flagged for future insight</p>`
          : "";
        entriesHtml.push(`
          <div style="margin-bottom: 1em; padding: 1em; border: 1px solid #ccc; border-radius: 5px;">
            <p style="font-size: 0.9em; color: #999;">${date}</p>
            ${manifestBadge}
            ${coachTag}
            ${futureFlag}
            <div class="entry-preview">${entry.text}</div>
            <button class="btn" style="margin-top: 0.5em;" onclick="this.previousElementSibling.classList.toggle('entry-preview'); this.textContent = this.textContent === 'Read more' ? 'Collapse' : 'Read more';">Read more</button>
            ${tags}
            ${entry.attachmentUrl ? `<p><a href="${entry.attachmentUrl}" target="_blank">View Attachment</a></p>` : ""}
            <button class="btn" onclick="editEntry('${doc.id}', \`${entry.text.replace(/`/g, "\\`")}\`)">Edit</button>
            <button class="btn" onclick="deleteEntry('${doc.id}')">Delete</button>
            ${coachRepliesHtml}
          </div>
        `);
      }

      pastEntriesContainer.innerHTML = entriesHtml.join("");
    }

    window.deleteEntry = async function (docId) {
      if (!confirm("Are you sure you want to delete this entry?")) return;
      try {
        await deleteDoc(doc(db, "journalEntries", docId));
        loadPastEntries(); // Refresh view
      } catch (err) {
        console.error("Error deleting entry:", err);
      }
    };

    window.editEntry = async function (docId, currentText) {
      const newText = prompt("Edit your entry:", currentText);
      if (!newText) return;
      try {
        await updateDoc(doc(db, "journalEntries", docId), { text: newText });
        loadPastEntries(); // Refresh view
      } catch (err) {
        console.error("Error updating entry:", err);
      }
    };

    // async function loadJournalTimeline() {
    //   // Disabled: #journalTimeline element no longer exists in HTML.
    //   // This function is commented out to prevent console errors.
    //   // If needed in the future, restore and provide a corresponding HTML element.
    // }


    async function signUp() {
      const email = document.getElementById("emailInput").value;
      const password = document.getElementById("passwordInput").value;
      try {
        await createUserWithEmailAndPassword(auth, email, password);
        const avatarUrl = document.getElementById("avatarUrlInput").value.trim();
await setDoc(doc(db, "users", auth.currentUser.uid), {
  avatarUrl,
  email: auth.currentUser.email
});
        alert("Signed up and logged in!");
        // TODO: Allow users to set a display name and avatar image for personalization
        document.getElementById("loginModal").style.display = "none";
        document.getElementById("userStatus").textContent = `Journaling as: ${auth.currentUser.email}`;
      } catch (err) {
        alert("Error signing up: " + err.message);
      }
    }

    async function signIn() {
      const email = document.getElementById("emailInput").value;
      const password = document.getElementById("passwordInput").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        
        document.getElementById("loginModal").style.display = "none";
        // UI state will be managed by onAuthStateChanged
      } catch (err) {
        alert("Login failed: " + err.message);
      }
    }

    
    let journalMode = 'manifest';

window.setJournalMode = function (mode) {
  journalMode = mode;
  const manifestBtn = document.getElementById("manifestModeButton");
  const freeBtn = document.getElementById("freeModeButton");

  if (mode === "manifest") {
    manifestBtn.style.backgroundColor = "#2A6D6D";
    manifestBtn.style.color = "white";
    freeBtn.style.backgroundColor = "#ccc";
    freeBtn.style.color = "#333";
  } else {
    freeBtn.style.backgroundColor = "#2A6D6D";
    freeBtn.style.color = "white";
    manifestBtn.style.backgroundColor = "#ccc";
    manifestBtn.style.color = "#333";
  }
};

    function showTab(tabId) {
      const tabs = ["journalTab", "calendarTab"];
      const buttons = {
        journalTab: document.getElementById("journalTabButton"),
        calendarTab: document.getElementById("calendarTabButton")
      };

      tabs.forEach(id => {
        document.getElementById(id).style.display = (id === tabId ? "block" : "none");
        if (buttons[id]) {
          buttons[id].style.backgroundColor = (id === tabId ? "#2A6D6D" : "#FFA76D");
          buttons[id].style.color = (id === tabId ? "white" : "white");
        }
      });
      if (tabId === "calendarTab") {
        // loadPastEntries(); // Disabled to prevent forever-scroll and encourage calendar/search interaction
        document.getElementById("calendarEntries") && (document.getElementById("calendarEntries").innerHTML = "<p>Click a calendar date to view entries.</p>");
        document.getElementById("searchResults") && (document.getElementById("searchResults").innerHTML = "<p>Use Smart Search to explore your journal history.</p>");
      } else if (tabId === "journalTab") {
        const manifestInput = document.getElementById("manifestInput");
        if (manifestInput && window.currentUserId) {
          getDoc(doc(db, "manifests", window.currentUserId))
            .then(manifestDoc => {
              if (manifestDoc.exists()) {
                manifestInput.value = manifestDoc.data().statement || "";
                console.log("‚úÖ Manifest loaded from showTab.");
              } else {
                console.log("‚ÑπÔ∏è No manifest found for this user.");
              }
            })
            .catch(err => {
              console.error("‚ùå Error loading manifest:", err);
            });
        }
      }
    }

    // Ensure Journal tab is highlighted on initial UI load
    showTab('journalTab');

// Make calendar month/year globals so they persist and are accessible
window.displayedMonth = new Date().getMonth();
window.displayedYear = new Date().getFullYear();

// Calendar build function
async function buildCalendar() {
  const container = document.getElementById("calendarContainer");
  container.innerHTML = "";

  // Fetch journal entry dates for current month/year
  const snapshot = await getDocs(query(
    collection(db, "journalEntries"),
    where("userId", "==", currentUserId)
  ));

  const markedDates = new Set();
  snapshot.forEach(doc => {
    const createdAt = doc.data().createdAt?.toDate?.();
    if (createdAt &&
        createdAt.getFullYear() === window.displayedYear &&
        createdAt.getMonth() === window.displayedMonth) {
      const key = `${createdAt.getFullYear()}-${String(createdAt.getMonth() + 1).padStart(2, '0')}-${String(createdAt.getDate()).padStart(2, '0')}`;
      markedDates.add(key);
    }
  });

  // Month/Year heading
  const currentMonthHeading = document.createElement("h3");
  const tempDate = new Date(window.displayedYear, window.displayedMonth, 1);
  currentMonthHeading.textContent = `${tempDate.toLocaleString('default', { month: 'long' })} ${window.displayedYear}`;
  currentMonthHeading.style.textAlign = "center";
  currentMonthHeading.style.color = "#2A6D6D";
  currentMonthHeading.style.marginTop = "1em";

  container.appendChild(currentMonthHeading);

  const calendarTable = document.createElement("table");
  calendarTable.style.width = "100%";
  calendarTable.style.textAlign = "center";
  calendarTable.style.borderCollapse = "collapse";
  calendarTable.style.marginTop = "1em";

  const headerRow = document.createElement("tr");
  const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
  days.forEach(day => {
    const th = document.createElement("th");
    th.textContent = day;
    th.style.padding = "0.5em";
    headerRow.appendChild(th);
  });
  calendarTable.appendChild(headerRow);

  const firstDay = new Date(window.displayedYear, window.displayedMonth, 1).getDay();
  const daysInMonth = new Date(window.displayedYear, window.displayedMonth + 1, 0).getDate();

  let row = document.createElement("tr");
  for (let i = 0; i < firstDay; i++) {
    row.appendChild(document.createElement("td"));
  }

  for (let day = 1; day <= daysInMonth; day++) {
    if ((row.children.length % 7) === 0) {
      calendarTable.appendChild(row);
      row = document.createElement("tr");
    }
    const td = document.createElement("td");
    td.textContent = day;
    td.style.cursor = "pointer";
    td.style.padding = "0.5em";
    td.style.border = "1px solid #ccc";
    // Add highlight if this day has a journal entry
    const key = `${window.displayedYear}-${String(window.displayedMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    if (markedDates.has(key)) {
      td.style.backgroundColor = "#FFE5B4"; // Light highlight to mark the date
      td.title = "Journal entry";
    }
    td.onclick = () => showPromptsByDate(window.displayedYear, window.displayedMonth, day);
    row.appendChild(td);
  }
  calendarTable.appendChild(row);
  container.appendChild(calendarTable);
}

// Ensure changeMonth is in global scope and updates displayedMonth/year, then calendar
window.changeMonth = function(offset) {
  window.displayedMonth += offset;
  if (window.displayedMonth < 0) {
    window.displayedMonth = 11;
    window.displayedYear--;
  } else if (window.displayedMonth > 11) {
    window.displayedMonth = 0;
    window.displayedYear++;
  }
  buildCalendar();
};

async function showPromptsByDate(year, month, day) {
  const container = document.getElementById("pastEntries");
  const selectedDate = new Date(year, month, day).toDateString();
  container.innerHTML = `<p><strong>Entries from ${selectedDate}:</strong></p>`;

  const journalRef = collection(db, "journalEntries");
  const snapshot = await getDocs(query(journalRef, where("userId", "==", currentUserId)));

  const matches = [];
  snapshot.forEach((doc) => {
    const data = doc.data();
    const savedDate = data.createdAt?.toDate().toDateString();
    if (savedDate === selectedDate) {
      matches.push({ text: data.text, contextManifest: data.contextManifest });
    }
  });

  if (matches.length === 0) {
    container.innerHTML += "<p>No entries found.</p>";
  } else {
    const ul = document.createElement("ul");
    matches.forEach(entry => {
      const li = document.createElement("li");
      li.innerHTML = `
        ${entry.contextManifest ? '‚ú® ' : ''}
        <div class="entry-preview"><em>${entry.text}</em></div>
        <button class="btn" style="margin-top: 0.5em;" onclick="this.previousElementSibling.classList.toggle('entry-preview'); this.textContent = this.textContent === 'Read more' ? 'Collapse' : 'Read more';">Read more</button>
      `;
      ul.appendChild(li);
    });
    container.appendChild(ul);
  }
}


    // Expose functions for UI onclick attributes
    window.generatePrompt = generatePrompt;
    window.signUp = signUp;
    window.signIn = signIn;

// Modal close function for login modal
window.loginModalClose = function () {
  document.getElementById("loginModal").style.display = "none";
  document.querySelector("main").style.display = "none";

  // Optional toast-like feedback
  const toast = document.createElement("div");
  toast.textContent = "You must log in to access the journal.";
  toast.style.position = "fixed";
  toast.style.bottom = "20px";
  toast.style.left = "50%";
  toast.style.transform = "translateX(-50%)";
  toast.style.backgroundColor = "#FFA76D";
  toast.style.color = "#fff";
  toast.style.padding = "1em 1.5em";
  toast.style.borderRadius = "5px";
  toast.style.boxShadow = "0 2px 6px rgba(0,0,0,0.2)";
  toast.style.zIndex = "9999";
  document.body.appendChild(toast);
  setTimeout(() => {
    toast.remove();
  }, 4000);
};


window.showSpinner = function (targetId, message = "Working...") {
  const el = document.getElementById(targetId);
  if (el) {
    el.innerHTML = `<span class="spinner"></span> ${message}`;
  }
};
    window.showTab = showTab;
    // Expose httpsCallable for use in non-module scripts
    window.httpsCallable = httpsCallable;
window.logOutUser = async function () {
  try {
    localStorage.setItem("userJustLoggedOut", "true");
    await auth.signOut();
    document.querySelector("main").style.display = "none";
    setTimeout(() => {
      document.getElementById("goodbyeModal").style.display = "flex";
    }, 100);
  } catch (err) {
    console.error("Logout failed:", err);
    alert("Logout failed.");
  }
};
async function askSophyAboutEntry() {
  const journalText = document.getElementById("journal").value.trim();
  const sophyInsight = document.getElementById("sophyInsight");

  if (!journalText) {
    sophyInsight.textContent = "Please write something in your journal first.";
    return;
  }
  sophyInsight.textContent = "Sophy is thinking...";
  try {
    const response = await fetch("https://us-central1-inkwell-alpha.cloudfunctions.net/askSophy", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ entry: journalText })
    });

    if (!response.ok) throw new Error("Failed to fetch insight.");

    const data = await response.json();
    const insight = data.insight?.trim?.() || "Sophy couldn't generate a reflection right now.";
    sophyInsight.textContent = insight;

  } catch (err) {
    console.error("Error fetching Sophy insight:", err);
    sophyInsight.textContent = "Sorry, Sophy couldn't reflect right now.";
  }
}

    window.askSophyAboutEntry = askSophyAboutEntry;

    // Manifest save function
    window.saveManifest = async function () {
      // Try to get user from Firebase Auth (compat or modular)
      let user = null;
      try {
        // Modular Firebase Auth
        user = auth.currentUser;
      } catch (e) {
        // fallback (should not happen in modular)
        user = null;
      }
      const text = document.getElementById("manifestInput").value.trim();
      const status = document.getElementById("manifestStatus");

      if (!user || !text) {
        status.textContent = "You must be logged in and enter a statement to save.";
        status.style.color = "red";
        return;
      }

      window.showSpinner("manifestStatus", "Saving...");

      try {
        await setDoc(doc(db, "manifests", user.uid), {
          statement: text,
          timestamp: serverTimestamp()
        });
        status.innerHTML = "‚úÖ Vision saved. You're building something meaningful.";
        status.style.color = "#2A6D6D";
      } catch (error) {
        console.error("Error saving manifest:", error);
        status.textContent = "Failed to save manifest.";
        status.style.color = "red";
      }
    };

    // Refine Manifest with Sophy
window.askSophyToRefineManifest = async function () {
  const text = document.getElementById("manifestInput").value.trim();
  const status = document.getElementById("manifestStatus");
  if (!text) {
    status.textContent = "Please write something first for Sophy to refine.";
    status.style.color = "red";
    return;
  }

  // Set Sophy "thinking" status before making the request
  status.textContent = "Sophy is thinking...";
  status.style.color = "#2A6D6D";

  try {
    const res = await fetch("https://us-central1-inkwell-alpha.cloudfunctions.net/askSophy", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ entry: `Help me improve this personal guiding statement: "${text}"` })
    });
    const data = await res.json();
    if (data.insight) {
      document.getElementById("manifestSuggestion").value = data.insight;
      status.textContent = "Sophy's ideas are available.";
      status.style.color = "#2A6D6D";
    } else {
      throw new Error(data.insight || "No insight returned.");
    }
  } catch (err) {
    console.error("Error fetching refinement:", err);
    status.textContent = "Failed to get Sophy's help.";
    status.style.color = "red";
  }
};
// Ensure calendar is built after defining all functions
// (Note: initial buildCalendar is also called by auth listener after login)
  </script>
</head>
<body>
  <header>
  <div id="goodbyeModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); color: #2A6D6D; display: none; align-items: center; justify-content: center; z-index: 9999;">
    <div class="card-block" style="max-width: 500px; width: 90%; text-align: center;">
      <h2 class="section-header">See You Soon!</h2>
      <p>Thanks for journaling with InkWell today.</p>
      <p>Take care, and don‚Äôt forget to stay positive.</p>
      <button class="btn" onclick="location.reload()" style="margin-top: 1.5em;">Return to Login</button>
    </div>
  </div>
    <img src="/InkWell Logo NoBG.png" alt="InkWell Logo" style="max-height: 120px; margin-bottom: 1em;" />
    <p>Your space to reflect, write, and grow.</p>
  </header>
  <div id="userStatus" style="font-size: 0.9em; margin-bottom: 1em;"></div>
  

  <div id="loginModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 9999;">
    <div class="card-block" style="max-width: 400px; width: 90%; box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);">
      <h3 class="section-header" style="text-align: center;">Login or Sign Up</h3>
      <input type="email" id="emailInput" placeholder="Email" style="width: 100%; margin-bottom: 0.5em; padding: 0.5em;" />
      <input type="password" id="passwordInput" placeholder="Password" style="width: 100%; margin-bottom: 0.5em; padding: 0.5em;" />
      <input type="text" id="avatarUrlInput" placeholder="Avatar image URL (optional)" style="width: 100%; margin-bottom: 0.5em; padding: 0.5em;" />
      <button class="btn" onclick="signUp()" style="width: 100%; margin-bottom: 0.5em;">Sign Up</button>
      <button class="btn" onclick="signIn()" style="width: 100%;">Sign In</button>
      <button class="btn" onclick="loginModalClose()" style="width: 100%; margin-top: 1em;">Close</button>
    </div>
  </div>
  <main style="display: block;">
    <div id="embeddedAgreementNotice" class="card-block" style="display: none; border: 2px dashed #FFA76D; background-color: #fff8f2;">
  <h3 class="section-header" style="color: #FFA76D;">Action Required: Accept Alpha Testing Agreement</h3>
  <p style="font-size: 0.9em;">Before you can use InkWell, please review and agree to the following:</p>
  <ul>
    <li><a href="https://www.pegasusrealm.com/terms-conditions/" target="_blank">Terms & Conditions</a></li>
    <li><a href="https://www.pegasusrealm.com/privacy-policy/" target="_blank">Privacy Policy</a></li>
    <li><a href="https://www.pegasusrealm.com/alpha-beta-testers/" target="_blank">Alpha/Beta Tester Agreement</a></li>
  </ul>
  <label style="display: block; margin-top: 1em;">
    <input type="checkbox" id="embeddedAgreementCheckbox" />
    I have read and agree to all three terms listed above.
  </label>
  <button class="btn" onclick="acceptEmbeddedAgreement()" id="acceptEmbeddedAgreementButton" disabled>Accept & Continue</button>
</div>
    <div id="tabButtons" style="display: flex; gap: 1em; margin-bottom: 1em;">
        <button class="btn" id="journalTabButton" onclick="showTab('journalTab')" style="flex: 1;">Journal</button>
        <button class="btn" id="calendarTabButton" onclick="showTab('calendarTab')" style="flex: 1;">Past Entries</button>
      </div>
    <div id="journalTab">
      <div class="card-block">
        <h3 class="section-header" style="text-align: center;">Your Manifest Statement</h3>
        <p style="font-size: 1em; line-height: 1.6; margin-top: 1em;">
          This Manifest Statement is your personal guiding goal or vision. It is visible to your coach and to Sophy so they can help you stay aligned and work toward it. You can ask Sophy or a coach to help you write or refine this statement at any time.
        </p>
        <textarea id="manifestInput" placeholder="Write your personal guiding statement..." style="width: 100%; height: 100px; margin-bottom: 0.5em; padding: 0.5em; border-radius: 5px; border: 1px solid #ccc;"></textarea>
        <button class="btn" onclick="saveManifest()">Save</button>
        <p id="manifestStatus" style="margin-top: 0.5em; font-style: italic;"></p>
        <p id="manifestSuggestionLabel" style="font-weight: bold; margin-top: 1em;">Sophy‚Äôs Suggested Refinement:</p>
        <textarea id="manifestSuggestion" readonly style="width: 100%; height: 100px; margin-bottom: 0.5em; padding: 0.5em; border-radius: 5px; border: 1px dashed #aaa; background-color: #fdfdfd;"></textarea>
        <button class="btn" onclick="askSophyToRefineManifest()">Refine with Sophy</button>
        
      </div>
      <div class="card-block">
        <!-- (Sophy prompt block moved below) -->
      </div>
      <div class="card-block">
        <h3 class="section-header" style="text-align: center;">Your Journal</h3>
        <p>
          Use this space to reflect on your Manifest Statement or free journal. Below, you'll find optional tools to enhance your entry ‚Äî you can ask Sophy for a writing prompt or upload images and files to enrich your thoughts or support your manifesting process.
        </p>
        <div id="journalModeToggle" style="display: flex; justify-content: center; gap: 1em; margin-bottom: 2em; padding-bottom: 0.5em;">
          <button class="btn" id="manifestModeButton" onclick="setJournalMode('manifest')" style="flex: 1; background-color: #2A6D6D; color: white;">Focus on Manifesting</button>
          <button class="btn" id="freeModeButton" onclick="setJournalMode('free')" style="flex: 1; background-color: #ccc; color: #333;">Free Journal</button>
        </div>
        <!-- (Attachment input and preview moved below) -->
            <p class="subtext-muted" style="margin-top: 1em;">If you want a topic or some inspiration, <strong>Sophy</strong> can suggest ideas ‚Äî you can even give her a topic to focus on.</p>
      <input type="text" id="promptTopic" placeholder="Enter a topic, mood, or leave blank" style="width: 100%; margin-bottom: 0.5em; padding: 0.5em; border-radius: 5px; border: 1px solid #ccc;" />
      <button class="btn" onclick="generatePrompt()">Ask Sophy for a Prompt</button>
      <p id="generatedPrompt" style="font-style: italic; color: #2A6D6D; margin-top: 0.5em; padding-left: 1em;">
        Sophy's suggestion will appear here.
      </p>
      <label style="font-size: 0.85em; display: block; margin-top: 0.5em; margin-bottom: 0.5em;">
        <input type="checkbox" id="autoInsertPrompt" checked />
        Include this prompt in my journal
      </label>

<button class="btn" onclick="saveJournalEntry()">Save Journal Entry</button>
<span id="saveStatus" style="margin-left: 10px; font-style: italic;"></span>

      <label style="font-size: 0.85em; display: block; margin-top: 1em;">
  <input type="checkbox" id="coachReviewCheckbox" />
  Tag this entry for my coach
</label>

<label for="journal" style="margin-top:1em; display:block; font-weight:600;">Journal Entry:</label>
<textarea id="journal" placeholder="Write your thoughts here..." style="width: 100%; box-sizing: border-box; margin-bottom: 0.5em;"></textarea>
<label style="font-size: 0.85em; display: block; margin-top: 0.5em;">
  <input type="checkbox" id="autoInsertReflection" checked />
  Include Sophy's reflection in my journal
</label>

      <div id="entryStatus" style="font-size: 0.85em; color: #2A6D6D; margin-top: 0.5em;"></div>
      <div id="sophyInsight" style="font-style: italic; color: #2A6D6D; margin: 1em 0; white-space: pre-wrap;">
        Sophy's Reflection will appear here after you ask for guidance.
      </div>
      <button class="btn" onclick="askSophyAboutEntry()">Ask Sophy for Reflection</button>
      <label for="attachment" style="margin-top: 1em; display: block;">Attach a photo or file:</label>
<input type="file" id="attachment" accept=".png,.jpg,.jpeg,.gif,.pdf,.doc,.docx,image/*" style="margin-bottom: 1em;" />      <div id="attachmentPreview" style="margin-bottom: 1em;"></div>
      </div>
    </div>
<div id="calendarTab" style="display: none;">
  <div class="card-block">
    <h3 class="section-header" style="text-align: center; color: #2A6D6D;">Journal Calendar</h3>
    <div id="calendarControls" style="text-align: center; margin-bottom: 1em;">
      <button class="btn" onclick="changeMonth(-1)">‚Üê Previous</button>
      <button class="btn" onclick="changeMonth(1)">Next ‚Üí</button>
    </div>
    <div id="calendarContainer"></div>
    <div id="pastEntries" style="margin-top: 1em;"></div>

    <!-- Smart Search Bar UI -->
    <div class="card-block" style="margin-top: 2em;">
      <h3 class="section-header">Smart Search Your Journal</h3>
      <input type="text" id="searchQuery" placeholder="e.g., burnout last week, goals, feeling stuck" style="width: 100%; padding: 0.5em; margin-bottom: 0.5em; border-radius: 5px; border: 1px solid #ccc;" />
      <button class="btn" onclick="runSmartSearch()">Search</button>
      <div id="searchResults" style="margin-top: 1em;"></div>
    </div>
    <script>
      // Smart search: embed query, fetch all entries, compare embeddings, sort by similarity, show top 5
      async function runSmartSearch() {
        // Ensure callable wrappers are defined
        const logQuery = window._logQueryFn || (window._logQueryFn = httpsCallable(functions, "logSearchQuery"));
        const queryText = document.getElementById("searchQuery").value.trim();
        const resultsContainer = document.getElementById("searchResults");
        showSpinner("searchResults", "Searching...");
        if (!queryText || !auth?.currentUser?.uid) {
          resultsContainer.innerHTML = "<p>Please enter a search phrase.</p>";
          return;
        }
        try {
          // Log the search query with Firebase callable function before embedding
          await logQuery({ query: queryText });
          // 1. Embed the query using HTTPS endpoint directly, with ID token
          const user = auth.currentUser;
          if (!user) throw new Error("User not authenticated.");
          const idToken = await user.getIdToken();
          const embedResp = await fetch("https://us-central1-inkwell-alpha.cloudfunctions.net/embedAndStoreEntry", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${idToken}`
            },
            body: JSON.stringify({ text: queryText })
          });
          if (!embedResp.ok) {
            throw new Error("Failed to get embedding for query.");
          }
          const embedResult = await embedResp.json();
          const queryEmbedding = embedResult.embedding;
          if (!queryEmbedding || !Array.isArray(queryEmbedding)) {
            throw new Error("Failed to get embedding for query.");
          }
          // 2. Fetch all user's journal entries with embeddings
          const entriesRef = collection(db, "journalEntries");
          const q = query(entriesRef, where("userId", "==", currentUserId));
          const snapshot = await getDocs(q);
          const entries = [];
          snapshot.forEach(docSnap => {
            const data = docSnap.data();
            // Only consider entries with an embedding array
            if (Array.isArray(data.embedding)) {
              entries.push({
                id: docSnap.id,
                text: data.text,
                tags: data.tags,
                createdAt: data.createdAt,
                embedding: data.embedding,
                contextManifest: data.contextManifest
              });
            }
          });
          if (entries.length === 0) {
            resultsContainer.innerHTML = "<p>No entries with embeddings found. Try saving a new entry first.</p>";
            return;
          }
          // 3. Calculate cosine similarity for each entry
          function cosineSimilarity(a, b) {
            let dot = 0, normA = 0, normB = 0;
            for (let i = 0; i < a.length; i++) {
              dot += a[i] * b[i];
              normA += a[i] * a[i];
              normB += b[i] * b[i];
            }
            if (normA === 0 || normB === 0) return 0;
            return dot / (Math.sqrt(normA) * Math.sqrt(normB));
          }
          for (const entry of entries) {
            entry.sim = cosineSimilarity(queryEmbedding, entry.embedding);
          }
          // 4. Sort by similarity descending, pick top 5
          const top = entries.sort((a, b) => b.sim - a.sim).slice(0, 5);
          // 5. Render results
          if (top.length === 0) {
            resultsContainer.innerHTML = "<p>No similar entries found.</p>";
            return;
          }
          let html = "<ol>";
          for (const entry of top) {
            const dateStr = entry.createdAt?.toDate?.().toLocaleString?.() || "";
            html += `<li style="margin-bottom: 1em;">
              <div style="font-size:0.85em; color:#999;">${dateStr}</div>
              ${entry.contextManifest ? `<div style="font-size:0.85em; color:#2A6D6D;">‚ú® Manifest: "${entry.contextManifest}"</div>` : ""}
              <div class="entry-preview">${entry.text}</div>
              <div style="font-size:0.8em; color:#888;">Similarity: ${(entry.sim*100).toFixed(1)}%</div>
              ${entry.tags ? `<div style="font-size:0.8em; color:#666;">Tags: ${entry.tags.join(", ")}</div>` : ""}
            </li>`;
          }
          html += "</ol>";
          resultsContainer.innerHTML = html;
        } catch (err) {
          console.error("Smart search error:", err);
          document.getElementById("searchResults").innerHTML = "<p>Sorry, something went wrong with smart search.</p>";
        }
      }
    </script>

  </div>
</div>
  </main>
  <div style="text-align: center; margin-top: 2em;">
    <button class="btn" onclick="logOutUser()">Logout</button>
  </div>
  <footer style="margin-top: 2em; font-size: 0.85em; text-align: center;">
    <p>¬© 2025 Pegasus Realm LLC. InkWell. All rights reserved.</p>
    <p>
      <a href="https://www.inkwelljournal.io/privacy-policy/" target="_blank" style="text-decoration: underline; color: #2A6D6D;">Privacy Policy</a> |
      <a href="https://www.inkwelljournal.io/terms-conditions/" target="_blank" style="text-decoration: underline; color: #2A6D6D;">Terms and Conditions</a> |
      <a href="https://www.inkwelljournal.io/alpha-beta-testers/" target="_blank" style="text-decoration: underline; color: #2A6D6D;">Alpha/Beta Tester Agreement</a>
    </p>
    <p>Contact support: <a href="mailto:support@inkwelljournal.io" style="text-decoration: underline; color: #2A6D6D;">support@inkwelljournal.io</a></p>
  </footer>
</body>
</html>

