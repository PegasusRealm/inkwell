rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // User profile docs
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Manifest docs
    match /manifests/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Journal entries
    match /journalEntries/{entryId} {
      allow read: if
        request.auth != null &&
        (
          resource.data.userId == request.auth.uid ||
          (resource.data.coachReview == true && request.auth.uid == 'ZiNM7YK1jnRgIkAKiCaO1lC6DGx2')
        );

      allow write: if
        request.auth != null &&
        (
          request.resource.data.userId == request.auth.uid ||
          (request.resource.data.coachReview == true && request.auth.uid == 'ZiNM7YK1jnRgIkAKiCaO1lC6DGx2')
        );
    }

    // Allow access to any entry where userId matches (for any new/other collections)
    match /{collection}/{docId} {
  allow read, write: if request.auth != null &&
    (
      !exists(resource) ||  // allow if the doc doesn't exist yet
      resource.data.userId == request.auth.uid
    );
}

    // Admin: allow full access for your admin account
    match /{document=**} {
      allow read, write: if request.auth != null
        && request.auth.uid == 'A0IogJr0UpXKs2ffMYa3g8Dg5HK2';
    }
  }
}